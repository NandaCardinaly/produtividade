<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Meu Sistema de Produtividade</title>
<link href="https://fonts.googleapis.com/css2?family=Fraunces:ital,opsz,wght@0,9..144,300;0,9..144,500;0,9..144,700;1,9..144,300&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet">
<style>
  :root {
    --bg:#f5f2ed;--surface:#faf8f5;--card:#ffffff;--border:#e8e2d9;
    --text:#1a1714;--text-muted:#8a8078;
    --accent:#c17b3f;--accent-light:#f5e8d8;
    --green:#4a7c59;--green-light:#dff0e5;
    --red:#c0392b;--red-light:#fde8e6;
    --blue:#2c6e9e;--blue-light:#ddeeff;
    --purple:#6b4fa0;--purple-light:#ede8f8;
    --teal:#2a8a7e;--teal-light:#ddf4f1;
    --orange:#d4721a;--orange-light:#fce8d0;
    --pink:#b5476e;--pink-light:#fce8f0;
    --shadow:0 2px 12px rgba(0,0,0,0.06);
    --shadow-lg:0 8px 32px rgba(0,0,0,0.12);
  }
  *{box-sizing:border-box;margin:0;padding:0;}
  body{font-family:'DM Sans',sans-serif;background:var(--bg);color:var(--text);min-height:100vh;font-size:14px;}
  #loading-screen{position:fixed;inset:0;background:var(--bg);z-index:9999;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:16px;}
  .spinner{width:36px;height:36px;border:3px solid var(--border);border-top-color:var(--accent);border-radius:50%;animation:spin 0.8s linear infinite;}
  @keyframes spin{to{transform:rotate(360deg);}}
  #loading-screen p{font-size:13px;color:var(--text-muted);}
  header{background:var(--card);border-bottom:1px solid var(--border);padding:0 28px;display:flex;align-items:center;justify-content:space-between;height:58px;position:sticky;top:0;z-index:200;gap:16px;}
  .logo{font-family:'Fraunces',serif;font-size:19px;font-weight:500;color:var(--accent);white-space:nowrap;}
  .logo span{color:var(--text);font-weight:300;font-style:italic;}
  .nav-tabs{display:flex;gap:4px;}
  .nav-tab{padding:6px 16px;border:none;background:none;border-radius:20px;cursor:pointer;font-family:'DM Sans',sans-serif;font-size:13px;color:var(--text-muted);transition:all 0.2s;}
  .nav-tab:hover{background:var(--bg);color:var(--text);}
  .nav-tab.active{background:var(--accent);color:white;font-weight:500;}
  .date-display{font-size:12px;color:var(--text-muted);white-space:nowrap;}
  .sync-indicator{font-size:11px;color:var(--text-muted);display:flex;align-items:center;gap:5px;white-space:nowrap;}
  .sync-dot{width:7px;height:7px;border-radius:50%;background:var(--green);flex-shrink:0;}
  .sync-dot.syncing{background:var(--accent);animation:pulse 1s infinite;}
  .sync-dot.error{background:var(--red);}
  @keyframes pulse{0%,100%{opacity:1;}50%{opacity:0.4;}}
  .view{display:none;padding:28px;animation:fadeIn 0.25s ease;}
  .view.active{display:block;}
  @keyframes fadeIn{from{opacity:0;transform:translateY(5px);}to{opacity:1;transform:translateY(0);}}
  .section-title{font-family:'Fraunces',serif;font-size:21px;font-weight:500;margin-bottom:20px;}
  .section-title span{color:var(--accent);font-style:italic;}
  .column{background:var(--surface);border:1px solid var(--border);border-radius:14px;overflow:hidden;display:flex;flex-direction:column;min-height:280px;max-height:580px;}
  .column-header{padding:13px 16px;font-weight:500;font-size:13px;display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid var(--border);background:var(--card);flex-shrink:0;gap:8px;}
  .col-label{display:flex;align-items:center;gap:8px;flex:1;min-width:0;}
  .col-dot{width:8px;height:8px;border-radius:50%;flex-shrink:0;}
  .col-title-text{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
  .count-badge{background:var(--bg);color:var(--text-muted);border-radius:10px;padding:2px 8px;font-size:11px;font-weight:500;flex-shrink:0;}
  .col-header-actions{display:flex;gap:4px;flex-shrink:0;}
  .col-header-btn{background:none;border:none;cursor:pointer;padding:3px 6px;border-radius:5px;font-size:13px;color:var(--text-muted);transition:all 0.15s;}
  .col-header-btn:hover{background:var(--red-light);color:var(--red);}
  .cards-area{padding:10px;overflow-y:auto;flex:1;display:flex;flex-direction:column;gap:7px;}
  .cards-area.drag-over{background:var(--accent-light);}
  .cards-area::-webkit-scrollbar{width:4px;}
  .cards-area::-webkit-scrollbar-thumb{background:var(--border);border-radius:2px;}
  .col-footer{padding:0 10px 10px;flex-shrink:0;}
  .card{background:var(--card);border:1px solid var(--border);border-radius:9px;padding:9px 11px;cursor:grab;transition:all 0.15s;box-shadow:var(--shadow);}
  .card:hover{box-shadow:var(--shadow-lg);transform:translateY(-1px);border-color:var(--accent);}
  .card.dragging{opacity:0.35;transform:rotate(2deg);}
  .card-title{font-size:13px;line-height:1.4;margin-bottom:5px;}
  .card-meta{display:flex;align-items:center;justify-content:space-between;gap:4px;flex-wrap:wrap;}
  .card-area-tag{font-size:10px;font-weight:500;padding:2px 7px;border-radius:5px;text-transform:uppercase;letter-spacing:0.4px;}
  .card-actions{display:flex;gap:3px;opacity:0;transition:opacity 0.15s;}
  .card:hover .card-actions{opacity:1;}
  .card-btn{background:none;border:none;cursor:pointer;padding:2px 5px;border-radius:4px;font-size:11px;color:var(--text-muted);transition:all 0.15s;white-space:nowrap;}
  .card-btn:hover{background:var(--bg);color:var(--text);}
  .card-btn.done-btn:hover{color:var(--green);}
  .card-btn.delete-btn:hover{color:var(--red);}
  .empty-state{text-align:center;padding:20px 10px;color:var(--text-muted);font-size:12px;font-style:italic;}
  .add-card-btn{display:flex;align-items:center;gap:6px;padding:7px 11px;border:1.5px dashed var(--border);border-radius:8px;background:none;cursor:pointer;font-family:'DM Sans',sans-serif;font-size:12px;color:var(--text-muted);width:100%;transition:all 0.2s;}
  .add-card-btn:hover{border-color:var(--accent);color:var(--accent);background:var(--accent-light);}
  .add-form{display:none;padding:10px;background:var(--card);border:1px solid var(--accent);border-radius:8px;margin-top:6px;}
  .add-form.open{display:block;}
  .add-form textarea{width:100%;border:none;outline:none;resize:none;font-family:'DM Sans',sans-serif;font-size:13px;background:none;color:var(--text);min-height:48px;margin-bottom:8px;}
  .add-form select{border:1px solid var(--border);border-radius:6px;padding:4px 8px;font-family:'DM Sans',sans-serif;font-size:12px;background:var(--bg);margin-bottom:8px;width:100%;color:var(--text);outline:none;}
  .form-btns{display:flex;gap:6px;}
  .btn-primary{background:var(--accent);color:white;border:none;border-radius:6px;padding:6px 14px;font-family:'DM Sans',sans-serif;font-size:12px;cursor:pointer;font-weight:500;}
  .btn-primary:hover{background:#a0622e;}
  .btn-primary:disabled{opacity:0.6;cursor:not-allowed;}
  .btn-ghost{background:none;border:none;padding:6px 10px;font-family:'DM Sans',sans-serif;font-size:12px;cursor:pointer;color:var(--text-muted);border-radius:6px;}
  .btn-ghost:hover{background:var(--bg);}
  .btn-danger{background:var(--red-light);color:var(--red);border:none;border-radius:6px;padding:6px 14px;font-family:'DM Sans',sans-serif;font-size:12px;cursor:pointer;}
  .btn-danger:hover{background:var(--red);color:white;}
  .board-3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:18px;}
  .board-auto{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:16px;}
  .col-semana .column-header{background:var(--accent-light)!important;}
  .col-dia .column-header{background:var(--green-light)!important;}
  .rotina-grid{display:grid;grid-template-columns:320px 1fr 1fr;gap:20px;align-items:start;}
  .rotina-card{background:var(--card);border:1px solid var(--border);border-radius:14px;overflow:hidden;box-shadow:var(--shadow);}
  .rotina-header{padding:15px 20px;background:linear-gradient(135deg,var(--accent) 0%,#9a5e2a 100%);color:white;display:flex;align-items:flex-start;justify-content:space-between;gap:10px;}
  .rotina-header-left h2{font-family:'Fraunces',serif;font-size:17px;font-weight:500;margin-bottom:2px;}
  .rotina-header-left p{font-size:12px;opacity:0.85;}
  .btn-edit-rotina{background:rgba(255,255,255,0.2);border:1px solid rgba(255,255,255,0.3);color:white;border-radius:7px;padding:5px 10px;font-size:11px;cursor:pointer;font-family:'DM Sans',sans-serif;white-space:nowrap;transition:all 0.2s;}
  .btn-edit-rotina:hover{background:rgba(255,255,255,0.35);}
  .progress-wrap{height:3px;background:rgba(0,0,0,0.08);}
  .progress-fill{height:100%;background:rgba(255,255,255,0.7);transition:width 0.4s ease;}
  .rotina-items{padding:10px;display:flex;flex-direction:column;gap:3px;}
  .rotina-item{display:flex;align-items:center;gap:9px;padding:9px 11px;border-radius:8px;transition:background 0.15s;cursor:pointer;user-select:none;}
  .rotina-item:hover{background:var(--bg);}
  .rotina-item.done{opacity:0.45;}
  .rotina-check{width:17px;height:17px;border:2px solid var(--border);border-radius:50%;flex-shrink:0;display:flex;align-items:center;justify-content:center;font-size:10px;transition:all 0.2s;}
  .rotina-item.done .rotina-check{background:var(--green);border-color:var(--green);color:white;}
  .rotina-time{font-size:11px;color:var(--text-muted);min-width:38px;font-weight:300;}
  .rotina-label{font-size:13px;flex:1;}
  .rotina-item.done .rotina-label{text-decoration:line-through;}
  .modal-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.45);z-index:500;align-items:center;justify-content:center;padding:20px;}
  .modal-overlay.open{display:flex;}
  .modal{background:var(--card);border-radius:16px;width:100%;max-width:520px;max-height:90vh;overflow-y:auto;box-shadow:var(--shadow-lg);animation:modalIn 0.25s ease;}
  @keyframes modalIn{from{opacity:0;transform:scale(0.96) translateY(10px);}to{opacity:1;transform:scale(1) translateY(0);}}
  .modal-header{padding:20px 24px 16px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;}
  .modal-header h3{font-family:'Fraunces',serif;font-size:18px;font-weight:500;}
  .modal-close{background:none;border:none;cursor:pointer;font-size:18px;color:var(--text-muted);padding:4px 8px;border-radius:6px;line-height:1;}
  .modal-close:hover{background:var(--bg);color:var(--text);}
  .modal-body{padding:20px 24px;}
  .modal-footer{padding:14px 24px;border-top:1px solid var(--border);display:flex;gap:8px;justify-content:flex-end;}
  .rotina-edit-list{display:flex;flex-direction:column;gap:6px;margin-bottom:16px;min-height:40px;}
  .rotina-edit-item{display:flex;align-items:center;gap:8px;padding:8px 10px;background:var(--bg);border-radius:8px;border:1px solid var(--border);}
  .rotina-edit-item.drag-over-item{border-color:var(--accent);background:var(--accent-light);}
  .drag-handle{cursor:grab;color:var(--text-muted);font-size:15px;flex-shrink:0;padding:0 2px;}
  .rotina-edit-time{border:1px solid var(--border);border-radius:6px;padding:4px 7px;font-family:'DM Sans',sans-serif;font-size:12px;width:68px;background:var(--card);color:var(--text);outline:none;}
  .rotina-edit-time:focus{border-color:var(--accent);}
  .rotina-edit-label{flex:1;border:1px solid var(--border);border-radius:6px;padding:4px 8px;font-family:'DM Sans',sans-serif;font-size:13px;background:var(--card);color:var(--text);outline:none;}
  .rotina-edit-label:focus{border-color:var(--accent);}
  .rotina-edit-del{background:none;border:none;cursor:pointer;padding:3px 6px;border-radius:5px;color:var(--text-muted);font-size:13px;flex-shrink:0;}
  .rotina-edit-del:hover{background:var(--red-light);color:var(--red);}
  .add-rotina-row{display:flex;gap:8px;align-items:center;padding:10px;background:var(--accent-light);border-radius:8px;border:1px dashed var(--accent);}
  .add-rotina-row input{border:1px solid var(--border);border-radius:6px;padding:5px 8px;font-family:'DM Sans',sans-serif;font-size:12px;background:var(--card);color:var(--text);outline:none;}
  .add-rotina-row input:focus{border-color:var(--accent);}
  .add-rotina-row .time-input{width:68px;}
  .add-rotina-row .label-input{flex:1;}
  .form-field{margin-bottom:16px;}
  .form-label{font-size:12px;font-weight:500;color:var(--text-muted);margin-bottom:6px;text-transform:uppercase;letter-spacing:0.5px;display:block;}
  .form-input{width:100%;border:1px solid var(--border);border-radius:8px;padding:8px 12px;font-family:'DM Sans',sans-serif;font-size:13px;background:var(--bg);color:var(--text);outline:none;transition:border-color 0.2s;}
  .form-input:focus{border-color:var(--accent);background:var(--card);}
  .color-picker{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px;}
  .color-opt{width:28px;height:28px;border-radius:50%;cursor:pointer;border:3px solid transparent;transition:all 0.15s;flex-shrink:0;}
  .color-opt:hover{transform:scale(1.15);}
  .color-opt.selected{border-color:var(--text);}
  .emoji-picker{display:flex;gap:6px;flex-wrap:wrap;margin-top:8px;}
  .emoji-opt{width:34px;height:34px;border-radius:7px;cursor:pointer;border:2px solid var(--border);display:flex;align-items:center;justify-content:center;font-size:16px;background:var(--bg);transition:all 0.15s;}
  .emoji-opt:hover{border-color:var(--accent);background:var(--accent-light);}
  .emoji-opt.selected{border-color:var(--accent);background:var(--accent-light);}
  .new-backlog-btn{display:flex;align-items:center;justify-content:center;gap:8px;background:var(--card);border:2px dashed var(--border);border-radius:14px;min-height:280px;cursor:pointer;font-family:'DM Sans',sans-serif;font-size:13px;color:var(--text-muted);transition:all 0.2s;flex-direction:column;width:100%;}
  .new-backlog-btn:hover{border-color:var(--accent);color:var(--accent);background:var(--accent-light);}
  .new-backlog-btn .plus{font-size:28px;line-height:1;}
  .done-section{margin-top:28px;border-top:1px solid var(--border);padding-top:20px;}
  .done-toggle{background:none;border:none;cursor:pointer;font-family:'DM Sans',sans-serif;font-size:13px;color:var(--text-muted);display:flex;align-items:center;gap:6px;padding:0;margin-bottom:12px;}
  .done-cards{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:7px;}
  .done-cards .card{opacity:0.5;cursor:default;}
  .done-cards .card .card-title{text-decoration:line-through;}
  .done-cards .card:hover{transform:none;box-shadow:var(--shadow);}
  .toast{position:fixed;bottom:22px;right:22px;background:var(--text);color:white;padding:9px 16px;border-radius:8px;font-size:13px;z-index:999;opacity:0;transform:translateY(8px);transition:all 0.25s;pointer-events:none;}
  .toast.show{opacity:1;transform:translateY(0);}
  @media(max-width:900px){
    .board-3,.rotina-grid{grid-template-columns:1fr;}
    .board-auto{grid-template-columns:1fr;}
    header{flex-wrap:wrap;height:auto;padding:10px 16px;gap:8px;}
    .view{padding:16px;}
  }
</style>
</head>
<body>
<div id="loading-screen">
  <div class="spinner"></div>
  <p>Conectando ao banco de dados...</p>
</div>
<header>
  <div class="logo">Meu Sistema <span>de Produtividade</span></div>
  <div class="nav-tabs">
    <button class="nav-tab active" onclick="switchView('rotina',this)">üåÖ Rotina</button>
    <button class="nav-tab" onclick="switchView('board',this)">üìã Board</button>
    <button class="nav-tab" onclick="switchView('backlog',this)">üì¶ Backlog</button>
  </div>
  <div style="display:flex;align-items:center;gap:14px;">
    <div class="sync-indicator"><div class="sync-dot" id="sync-dot"></div><span id="sync-text">Sincronizado</span></div>
    <div class="date-display" id="date-display"></div>
  </div>
</header>
<div class="view active" id="view-rotina">
  <div class="rotina-grid">
    <div class="rotina-card">
      <div class="rotina-header">
        <div class="rotina-header-left">
          <h2>Rotina Di√°ria</h2>
          <p id="rotina-progress-text">carregando...</p>
        </div>
        <button class="btn-edit-rotina" onclick="openRotinaEditor()">‚úèÔ∏è Editar</button>
      </div>
      <div class="progress-wrap"><div class="progress-fill" id="progress-bar" style="width:0%"></div></div>
      <div class="rotina-items" id="rotina-items"></div>
    </div>
    <div>
      <h2 class="section-title">Prioridades do <span>Dia</span></h2>
      <div class="column col-dia" style="max-height:none;">
        <div class="column-header">
          <div class="col-label"><div class="col-dot" style="background:var(--green)"></div><span>Prioridades do Dia</span></div>
          <span class="count-badge" id="count-dia">0</span>
        </div>
        <div class="cards-area" id="col-dia" ondragover="onDragOver(event)" ondrop="onDrop(event,'dia')" ondragleave="onDragLeave(event)"></div>
        <div class="col-footer">
          <button class="add-card-btn" onclick="openForm('form-dia')">+ Adicionar tarefa</button>
          <div class="add-form" id="form-dia">
            <textarea id="input-dia" placeholder="Descri√ß√£o da tarefa..." rows="2"></textarea>
            <select id="area-dia"></select>
            <div class="form-btns">
              <button class="btn-primary" onclick="addCard('dia','input-dia','area-dia')">Adicionar</button>
              <button class="btn-ghost" onclick="closeForm('form-dia')">Cancelar</button>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div>
      <h2 class="section-title">Prioridades da <span>Semana</span></h2>
      <div class="column col-semana" style="max-height:none;">
        <div class="column-header">
          <div class="col-label"><div class="col-dot" style="background:var(--accent)"></div><span>Prioridades da Semana</span></div>
          <span class="count-badge" id="count-semana">0</span>
        </div>
        <div class="cards-area" id="col-semana" ondragover="onDragOver(event)" ondrop="onDrop(event,'semana')" ondragleave="onDragLeave(event)"></div>
        <div class="col-footer">
          <button class="add-card-btn" onclick="openForm('form-semana')">+ Adicionar tarefa</button>
          <div class="add-form" id="form-semana">
            <textarea id="input-semana" placeholder="Descri√ß√£o da tarefa..." rows="2"></textarea>
            <select id="area-semana"></select>
            <div class="form-btns">
              <button class="btn-primary" onclick="addCard('semana','input-semana','area-semana')">Adicionar</button>
              <button class="btn-ghost" onclick="closeForm('form-semana')">Cancelar</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="done-section" id="done-section" style="display:none;">
    <button class="done-toggle" onclick="toggleDone()"><span id="done-arrow">‚ñ∂</span> Conclu√≠das (<span id="done-count">0</span>)</button>
    <div class="done-cards" id="done-cards" style="display:none;"></div>
  </div>
</div>
<div class="view" id="view-board">
  <h2 class="section-title">Vis√£o <span>Geral</span></h2>
  <div class="board-3">
    <div class="column col-semana">
      <div class="column-header">
        <div class="col-label"><div class="col-dot" style="background:var(--accent)"></div><span>Prioridades da Semana</span></div>
        <span class="count-badge" id="board-count-semana">0</span>
      </div>
      <div class="cards-area" id="board-col-semana" ondragover="onDragOver(event)" ondrop="onDrop(event,'semana')" ondragleave="onDragLeave(event)"></div>
    </div>
    <div class="column col-dia">
      <div class="column-header">
        <div class="col-label"><div class="col-dot" style="background:var(--green)"></div><span>Prioridades do Dia</span></div>
        <span class="count-badge" id="board-count-dia">0</span>
      </div>
      <div class="cards-area" id="board-col-dia" ondragover="onDragOver(event)" ondrop="onDrop(event,'dia')" ondragleave="onDragLeave(event)"></div>
    </div>
    <div class="column">
      <div class="column-header">
        <div class="col-label"><div class="col-dot" style="background:#aaa"></div><span>Todos os Backlogs</span></div>
        <span class="count-badge" id="board-count-all">0</span>
      </div>
      <div class="cards-area" id="board-col-all"></div>
    </div>
  </div>
</div>
<div class="view" id="view-backlog">
  <h2 class="section-title">Backlog <span>por √Årea</span></h2>
  <div class="board-auto" id="backlog-grid"></div>
</div>
<div class="modal-overlay" id="modal-rotina">
  <div class="modal">
    <div class="modal-header">
      <h3>Editar Rotina Di√°ria</h3>
      <button class="modal-close" onclick="closeModal('modal-rotina')">‚úï</button>
    </div>
    <div class="modal-body">
      <p style="font-size:12px;color:var(--text-muted);margin-bottom:14px;">Arraste ‚†ø para reordenar. Clique ‚úï para remover.</p>
      <div class="rotina-edit-list" id="rotina-edit-list"></div>
      <div class="add-rotina-row">
        <input class="time-input" type="time" id="new-rotina-time" value="09:00">
        <input class="label-input" type="text" id="new-rotina-label" placeholder="Nome do item...">
        <button class="btn-primary" onclick="addRotinaItem()">+ Adicionar</button>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn-ghost" onclick="closeModal('modal-rotina')">Cancelar</button>
      <button class="btn-primary" id="btn-save-rotina" onclick="saveRotinaEdits()">‚úì Salvar Rotina</button>
    </div>
  </div>
</div>
<div class="modal-overlay" id="modal-new-backlog">
  <div class="modal">
    <div class="modal-header">
      <h3>Nova Lista de Backlog</h3>
      <button class="modal-close" onclick="closeModal('modal-new-backlog')">‚úï</button>
    </div>
    <div class="modal-body">
      <div class="form-field">
        <label class="form-label">Nome da lista</label>
        <input class="form-input" type="text" id="new-backlog-name" placeholder="Ex: Projetos Pessoais">
      </div>
      <div class="form-field">
        <label class="form-label">Emoji</label>
        <div class="emoji-picker" id="emoji-picker"></div>
      </div>
      <div class="form-field">
        <label class="form-label">Cor</label>
        <div class="color-picker" id="color-picker"></div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn-ghost" onclick="closeModal('modal-new-backlog')">Cancelar</button>
      <button class="btn-primary" id="btn-create-backlog" onclick="createNewBacklog()">Criar Lista</button>
    </div>
  </div>
</div>
<div class="modal-overlay" id="modal-delete-backlog">
  <div class="modal" style="max-width:380px;">
    <div class="modal-header">
      <h3>Excluir lista?</h3>
      <button class="modal-close" onclick="closeModal('modal-delete-backlog')">‚úï</button>
    </div>
    <div class="modal-body">
      <p style="font-size:13px;color:var(--text-muted);">Tem certeza que deseja excluir a lista <strong id="delete-backlog-name"></strong>? Todos os cards ser√£o perdidos.</p>
    </div>
    <div class="modal-footer">
      <button class="btn-ghost" onclick="closeModal('modal-delete-backlog')">Cancelar</button>
      <button class="btn-danger" onclick="confirmDeleteBacklog()">Excluir</button>
    </div>
  </div>
</div>
<div class="toast" id="toast"></div>
<script>
const SUPA_URL='https://uztmjkhvzzfwyihzcxrs.supabase.co';
const SUPA_KEY='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InV6dG1qa2h2enpmd3lpaHpjeHJzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE1MjczMjYsImV4cCI6MjA4NzEwMzMyNn0.Id6KZhixeclFIA6Vm89xjh3PMFsccYPIKmueAPXDqjE';
async function supa(path,method,body){
  setSyncing(true);
  try{
    const opts={method:method||'GET',headers:{'apikey':SUPA_KEY,'Authorization':'Bearer '+SUPA_KEY,'Content-Type':'application/json','Prefer':method==='POST'?'return=representation':''}};
    if(body) opts.body=JSON.stringify(body);
    const res=await fetch(SUPA_URL+'/rest/v1/'+path,opts);
    if(!res.ok){const e=await res.text();throw new Error(e);}
    const t=await res.text();
    setSyncing(false);
    return t?JSON.parse(t):[];
  }catch(e){setError();throw e;}
}
const db={
  get:(table,q)=>supa(table+'?order=position'+(q?'&'+q:''),'GET'),
  insert:(table,data)=>supa(table,'POST',data),
  update:(table,id,data)=>supa(table+'?id=eq.'+id,'PATCH',data),
  delete:(table,id)=>supa(table+'?id=eq.'+id,'DELETE'),
  deleteWhere:(table,field,val)=>supa(table+'?'+field+'=eq.'+encodeURIComponent(val),'DELETE'),
  deleteAll:(table)=>supa(table+'?id=neq.XXXX_NEVER_MATCHES','DELETE'),
};
function setSyncing(v){
  const dot=document.getElementById('sync-dot'),txt=document.getElementById('sync-text');
  if(v){dot.className='sync-dot syncing';txt.textContent='Sincronizando...';}
  else{dot.className='sync-dot';txt.textContent='Sincronizado';}
}
function setError(){
  const dot=document.getElementById('sync-dot'),txt=document.getElementById('sync-text');
  dot.className='sync-dot error';txt.textContent='Erro de conex√£o';
}
const COLOR_OPTIONS=[
  {key:'blue',bg:'#ddeeff',text:'#2c6e9e',dot:'#2c6e9e'},
  {key:'green',bg:'#dff0e5',text:'#4a7c59',dot:'#4a7c59'},
  {key:'red',bg:'#fde8e6',text:'#c0392b',dot:'#c0392b'},
  {key:'purple',bg:'#ede8f8',text:'#6b4fa0',dot:'#6b4fa0'},
  {key:'teal',bg:'#ddf4f1',text:'#2a8a7e',dot:'#2a8a7e'},
  {key:'orange',bg:'#fce8d0',text:'#d4721a',dot:'#d4721a'},
  {key:'pink',bg:'#fce8f0',text:'#b5476e',dot:'#b5476e'},
  {key:'accent',bg:'#f5e8d8',text:'#c17b3f',dot:'#c17b3f'},
];
const EMOJI_OPTIONS=['üìÅ','üíº','üë®‚Äçüë©‚Äçüëß','üíö','üìö','üéØ','üå±','üí°','üõ†Ô∏è','‚úàÔ∏è','üèÉ','üé®','üè†','üí∞','üìä','üî¨','üß†','‚≠ê','üåü','üöÄ'];
let rotina=[],backlogs=[],cards={},showDone=false;
let dragId=null,dragFrom=null,pendingDeleteKey=null;
let selColor=COLOR_OPTIONS[0].key,selEmoji=EMOJI_OPTIONS[0];
let rotinaEditList=[],rotinaEditDragIdx=null;

async function init(){
  document.getElementById('date-display').textContent=new Date().toLocaleDateString('pt-BR',{weekday:'long',day:'numeric',month:'long'});
  try{
    const[rotinaData,backlogsData,cardsData]=await Promise.all([db.get('rotina'),db.get('backlogs'),db.get('cards')]);
    rotina=rotinaData; backlogs=backlogsData;
    cards={semana:[],dia:[],done:[]};
    backlogs.forEach(b=>cards[b.key]=[]);
    cardsData.forEach(c=>{if(!cards[c.col])cards[c.col]=[];cards[c.col].push(c);});
    document.getElementById('loading-screen').style.display='none';
    renderRotina(); populateAreaSelects(); renderAllViews(); buildBacklogGrid(); buildColorPicker(); buildEmojiPicker();
  }catch(e){
    document.querySelector('#loading-screen p').textContent='‚ùå Erro ao conectar. Verifique as configura√ß√µes do Supabase.';
    console.error(e);
  }
}
function getColor(key){return COLOR_OPTIONS.find(c=>c.key===key)||COLOR_OPTIONS[0];}
function buildColorPicker(){
  const el=document.getElementById('color-picker');el.innerHTML='';
  COLOR_OPTIONS.forEach(c=>{
    const d=document.createElement('div');d.className='color-opt'+(c.key===selColor?' selected':'');d.style.background=c.dot;
    d.onclick=()=>{selColor=c.key;el.querySelectorAll('.color-opt').forEach(x=>x.classList.remove('selected'));d.classList.add('selected');};
    el.appendChild(d);
  });
}
function buildEmojiPicker(){
  const el=document.getElementById('emoji-picker');el.innerHTML='';
  EMOJI_OPTIONS.forEach(e=>{
    const d=document.createElement('div');d.className='emoji-opt'+(e===selEmoji?' selected':'');d.textContent=e;
    d.onclick=()=>{selEmoji=e;el.querySelectorAll('.emoji-opt').forEach(x=>x.classList.remove('selected'));d.classList.add('selected');};
    el.appendChild(d);
  });
}
function populateAreaSelects(){
  const opts='<option value="geral">üîµ Geral</option>'+backlogs.map(b=>`<option value="${b.key}">${b.emoji} ${b.label}</option>`).join('');
  ['area-dia','area-semana'].forEach(id=>{const el=document.getElementById(id);if(el)el.innerHTML=opts;});
}
function renderRotina(){
  const container=document.getElementById('rotina-items');container.innerHTML='';
  rotina.forEach(item=>{
    const el=document.createElement('div');el.className='rotina-item'+(item.done?' done':'');el.onclick=()=>toggleRotina(item.id);
    el.innerHTML=`<div class="rotina-check">${item.done?'‚úì':''}</div><span class="rotina-time">${item.time_val}</span><span class="rotina-label">${item.label}</span>`;
    container.appendChild(el);
  });
  const done=rotina.filter(r=>r.done).length,total=rotina.length;
  document.getElementById('rotina-progress-text').textContent=`${done} de ${total} conclu√≠dos`;
  document.getElementById('progress-bar').style.width=total?(done/total*100)+'%':'0%';
}
async function toggleRotina(id){
  const item=rotina.find(r=>r.id===id);if(!item)return;
  item.done=!item.done;renderRotina();
  try{await db.update('rotina',id,{done:item.done});}
  catch(e){item.done=!item.done;renderRotina();toast('‚ùå Erro ao salvar');}
}
function openRotinaEditor(){rotinaEditList=rotina.map(r=>({...r}));renderRotinaEditList();openModal('modal-rotina');}
function renderRotinaEditList(){
  const container=document.getElementById('rotina-edit-list');container.innerHTML='';
  rotinaEditList.forEach((item,idx)=>{
    const el=document.createElement('div');el.className='rotina-edit-item';el.draggable=true;
    el.ondragstart=()=>{rotinaEditDragIdx=idx;setTimeout(()=>el.style.opacity='0.4',0);};
    el.ondragend=()=>{el.style.opacity='1';rotinaEditDragIdx=null;};
    el.ondragover=(e)=>{e.preventDefault();document.querySelectorAll('.rotina-edit-item').forEach(x=>x.classList.remove('drag-over-item'));el.classList.add('drag-over-item');};
    el.ondragleave=()=>el.classList.remove('drag-over-item');
    el.ondrop=(e)=>{
      e.preventDefault();el.classList.remove('drag-over-item');
      if(rotinaEditDragIdx===null||rotinaEditDragIdx===idx)return;
      readRotinaEditInputs();
      const moved=rotinaEditList.splice(rotinaEditDragIdx,1)[0];
      rotinaEditList.splice(idx,0,moved);renderRotinaEditList();
    };
    el.innerHTML=`<span class="drag-handle">‚†ø</span><input class="rotina-edit-time" type="time" value="${item.time_val}" onchange="rotinaEditList[${idx}].time_val=this.value"><input class="rotina-edit-label" type="text" value="${item.label}" onchange="rotinaEditList[${idx}].label=this.value"><button class="rotina-edit-del" onclick="removeRotinaEditItem(${idx})">‚úï</button>`;
    container.appendChild(el);
  });
}
function readRotinaEditInputs(){
  document.querySelectorAll('#rotina-edit-list .rotina-edit-item').forEach((el,idx)=>{
    if(rotinaEditList[idx]){
      rotinaEditList[idx].time_val=el.querySelector('.rotina-edit-time').value;
      const lv=el.querySelector('.rotina-edit-label').value.trim();
      if(lv)rotinaEditList[idx].label=lv;
    }
  });
}
function removeRotinaEditItem(idx){rotinaEditList.splice(idx,1);renderRotinaEditList();}
function addRotinaItem(){
  const timeEl=document.getElementById('new-rotina-time'),labelEl=document.getElementById('new-rotina-label'),label=labelEl.value.trim();
  if(!label){labelEl.focus();return;}
  rotinaEditList.push({id:'r'+Date.now(),time_val:timeEl.value||'09:00',label,done:false,position:rotinaEditList.length});
  labelEl.value='';renderRotinaEditList();
}
async function saveRotinaEdits(){
  readRotinaEditInputs();
  const btn=document.getElementById('btn-save-rotina');btn.disabled=true;btn.textContent='Salvando...';
  try{
    await supa('rotina?position=gte.0','DELETE');
    const toInsert=rotinaEditList.map((r,i)=>({id:r.id||'r'+Date.now()+i,time_val:r.time_val,label:r.label,done:r.done||false,position:i}));
    if(toInsert.length)await db.insert('rotina',toInsert);
    rotina=toInsert;renderRotina();closeModal('modal-rotina');toast('‚úì Rotina salva!');
  }catch(e){toast('‚ùå Erro ao salvar rotina');console.error(e);}
  btn.disabled=false;btn.textContent='‚úì Salvar Rotina';
}
function buildBacklogGrid(){
  const grid=document.getElementById('backlog-grid');grid.innerHTML='';
  backlogs.forEach(area=>grid.appendChild(makeBacklogColumn(area)));
  const newBtn=document.createElement('button');newBtn.className='new-backlog-btn';
  newBtn.onclick=()=>{selColor=COLOR_OPTIONS[0].key;selEmoji=EMOJI_OPTIONS[0];document.getElementById('new-backlog-name').value='';buildColorPicker();buildEmojiPicker();openModal('modal-new-backlog');};
  newBtn.innerHTML='<span class="plus">+</span><span>Nova lista</span>';
  grid.appendChild(newBtn);renderAllViews();
}
function makeBacklogColumn(area){
  const color=getColor(area.color),col=document.createElement('div');col.className='column';col.id='col-wrap-'+area.key;
  col.innerHTML=`<div class="column-header" style="background:${color.bg}"><div class="col-label"><div class="col-dot" style="background:${color.dot}"></div><span class="col-title-text">${area.emoji} ${area.label}</span></div><div style="display:flex;align-items:center;gap:6px;"><span class="count-badge" id="backlog-count-${area.key}">0</span><div class="col-header-actions"><button class="col-header-btn" title="Excluir lista" onclick="askDeleteBacklog('${area.key}','${area.label}')">üóë</button></div></div></div><div class="cards-area" id="backlog-col-${area.key}" ondragover="onDragOver(event)" ondrop="onDrop(event,'${area.key}')" ondragleave="onDragLeave(event)"></div><div class="col-footer"><button class="add-card-btn" onclick="openForm('bform-${area.key}')">+ Adicionar</button><div class="add-form" id="bform-${area.key}"><textarea id="binput-${area.key}" placeholder="Nova tarefa..." rows="2"></textarea><div class="form-btns"><button class="btn-primary" onclick="addCardBacklog('${area.key}')">Adicionar</button><button class="btn-ghost" onclick="closeForm('bform-${area.key}')">Cancelar</button></div></div></div>`;
  return col;
}
async function createNewBacklog(){
  const name=document.getElementById('new-backlog-name').value.trim();if(!name){document.getElementById('new-backlog-name').focus();return;}
  const btn=document.getElementById('btn-create-backlog');btn.disabled=true;btn.textContent='Criando...';
  const key='bl_'+Date.now(),newArea={key,label:name,emoji:selEmoji,color:selColor,position:backlogs.length};
  try{
    await db.insert('backlogs',[newArea]);backlogs.push(newArea);cards[key]=[];
    populateAreaSelects();buildBacklogGrid();closeModal('modal-new-backlog');toast(`‚úì Lista "${name}" criada!`);
  }catch(e){toast('‚ùå Erro ao criar lista');}
  btn.disabled=false;btn.textContent='Criar Lista';
}
function askDeleteBacklog(key,label){pendingDeleteKey=key;document.getElementById('delete-backlog-name').textContent='"'+label+'"';openModal('modal-delete-backlog');}
async function confirmDeleteBacklog(){
  if(!pendingDeleteKey)return;
  try{
    await db.deleteWhere('cards','col',pendingDeleteKey);await db.delete('backlogs',pendingDeleteKey);
    backlogs=backlogs.filter(b=>b.key!==pendingDeleteKey);delete cards[pendingDeleteKey];
    populateAreaSelects();buildBacklogGrid();closeModal('modal-delete-backlog');toast('Lista exclu√≠da.');
  }catch(e){toast('‚ùå Erro ao excluir lista');}
  pendingDeleteKey=null;
}
function isBacklogCol(col){return backlogs.some(b=>b.key===col);}
function getAreaStyle(key){
  if(key==='geral')return{bg:'#e8e4de',text:'#5a5450'};
  const bl=backlogs.find(b=>b.key===key);if(!bl)return{bg:'#e8e4de',text:'#5a5450'};
  const c=getColor(bl.color);return{bg:c.bg,text:c.text};
}
function getAreaLabel(key){
  if(key==='geral')return'üîµ Geral';
  const bl=backlogs.find(b=>b.key===key);return bl?bl.emoji+' '+bl.label:key;
}
function makeCardEl(card,col){
  const el=document.createElement('div');el.className='card';el.draggable=true;
  el.ondragstart=(e)=>{dragId=card.id;dragFrom=col;el.classList.add('dragging');e.dataTransfer.effectAllowed='move';};
  el.ondragend=()=>el.classList.remove('dragging');
  const s=getAreaStyle(card.area),lb=getAreaLabel(card.area),isBack=isBacklogCol(col);
  const doneBtn=col!=='done'?`<button class="card-btn done-btn" onclick="completeCard('${card.id}','${col}')">‚úì</button>`:'';
  const movSemBtn=isBack?`<button class="card-btn" onclick="moveCard('${card.id}','${col}','semana')">‚Üí Sem</button>`:'';
  const movDiaBtn=col==='semana'?`<button class="card-btn" onclick="moveCard('${card.id}','semana','dia')">‚Üí Dia</button>`:'';
  const bakSemBtn=col==='dia'?`<button class="card-btn" onclick="moveCard('${card.id}','dia','semana')">‚Üê Sem</button>`:'';
  const delBtn=`<button class="card-btn delete-btn" onclick="deleteCard('${card.id}','${col}')">‚úï</button>`;
  el.innerHTML=`<div class="card-title">${card.title}</div><div class="card-meta"><span class="card-area-tag" style="background:${s.bg};color:${s.text}">${lb}</span><div class="card-actions">${doneBtn}${movSemBtn}${movDiaBtn}${bakSemBtn}${delBtn}</div></div>`;
  return el;
}
function renderCol(colId,targetEl){
  if(!targetEl)return;targetEl.innerHTML='';
  const cc=cards[colId]||[];
  if(!cc.length){targetEl.innerHTML='<div class="empty-state">Sem tarefas aqui</div>';return;}
  cc.forEach(c=>targetEl.appendChild(makeCardEl(c,colId)));
}
function renderAllViews(){
  renderCol('dia',document.getElementById('col-dia'));
  renderCol('semana',document.getElementById('col-semana'));
  renderCol('semana',document.getElementById('board-col-semana'));
  renderCol('dia',document.getElementById('board-col-dia'));
  const allEl=document.getElementById('board-col-all');
  if(allEl){
    allEl.innerHTML='';
    const allCards=backlogs.flatMap(b=>(cards[b.key]||[]).map(c=>({card:c,col:b.key})));
    if(!allCards.length)allEl.innerHTML='<div class="empty-state">Backlog vazio</div>';
    else allCards.forEach(({card,col})=>allEl.appendChild(makeCardEl(card,col)));
  }
  backlogs.forEach(b=>renderCol(b.key,document.getElementById('backlog-col-'+b.key)));
  updateCounts();renderDone();
}
function updateCounts(){
  const set=(id,col)=>{const el=document.getElementById(id);if(el)el.textContent=(cards[col]||[]).length;};
  set('count-dia','dia');set('count-semana','semana');set('board-count-semana','semana');set('board-count-dia','dia');
  const all=backlogs.reduce((s,b)=>s+(cards[b.key]||[]).length,0);
  const bca=document.getElementById('board-count-all');if(bca)bca.textContent=all;
  backlogs.forEach(b=>set('backlog-count-'+b.key,b.key));
}
function renderDone(){
  const dc=cards.done||[];
  const section=document.getElementById('done-section'),doneCount=document.getElementById('done-count');
  if(!section)return;section.style.display=dc.length>0?'block':'none';
  if(doneCount)doneCount.textContent=dc.length;
  const container=document.getElementById('done-cards');
  if(container){container.innerHTML='';dc.forEach(c=>container.appendChild(makeCardEl(c,'done')));}
}
async function addCard(col,inputId,areaId){
  const input=document.getElementById(inputId),areaEl=document.getElementById(areaId),title=input.value.trim();if(!title)return;
  const card={id:'c'+Date.now(),title,area:areaEl?areaEl.value:'geral',col,position:(cards[col]||[]).length};
  if(!cards[col])cards[col]=[];cards[col].push(card);input.value='';renderAllViews();
  try{await db.insert('cards',[card]);toast('Tarefa adicionada!');}
  catch(e){cards[col]=cards[col].filter(c=>c.id!==card.id);renderAllViews();toast('‚ùå Erro ao salvar');}
}
async function addCardBacklog(col){
  const input=document.getElementById('binput-'+col),title=input.value.trim();if(!title)return;
  const card={id:'c'+Date.now(),title,area:col,col,position:(cards[col]||[]).length};
  if(!cards[col])cards[col]=[];cards[col].push(card);input.value='';renderAllViews();
  try{await db.insert('cards',[card]);toast('Tarefa adicionada!');}
  catch(e){cards[col]=cards[col].filter(c=>c.id!==card.id);renderAllViews();toast('‚ùå Erro ao salvar');}
}
async function completeCard(id,col){
  const idx=(cards[col]||[]).findIndex(c=>c.id===id);if(idx===-1)return;
  const[card]=cards[col].splice(idx,1);if(!cards.done)cards.done=[];
  cards.done.unshift({...card,col:'done'});renderAllViews();
  try{await db.update('cards',id,{col:'done'});toast('‚úì Tarefa conclu√≠da!');}
  catch(e){cards[col].splice(idx,0,card);cards.done.shift();renderAllViews();toast('‚ùå Erro ao salvar');}
}
async function moveCard(id,fromCol,toCol){
  const idx=(cards[fromCol]||[]).findIndex(c=>c.id===id);if(idx===-1)return;
  const[card]=cards[fromCol].splice(idx,1);if(!cards[toCol])cards[toCol]=[];
  cards[toCol].push({...card,col:toCol});renderAllViews();
  try{await db.update('cards',id,{col:toCol});toast(`Movido para ${{semana:'Semana',dia:'Dia'}[toCol]||toCol}!`);}
  catch(e){cards[toCol].pop();cards[fromCol].splice(idx,0,card);renderAllViews();toast('‚ùå Erro ao mover');}
}
async function deleteCard(id,col){
  const idx=(cards[col]||[]).findIndex(c=>c.id===id);if(idx===-1)return;
  const[card]=cards[col].splice(idx,1);renderAllViews();
  try{await db.delete('cards',id);toast('Tarefa removida.');}
  catch(e){cards[col].splice(idx,0,card);renderAllViews();toast('‚ùå Erro ao excluir');}
}
function onDragOver(e){e.preventDefault();e.currentTarget.classList.add('drag-over');e.dataTransfer.dropEffect='move';}
function onDragLeave(e){e.currentTarget.classList.remove('drag-over');}
function onDrop(e,toCol){
  e.preventDefault();e.currentTarget.classList.remove('drag-over');
  if(!dragId||!dragFrom||dragFrom===toCol){dragId=null;dragFrom=null;return;}
  moveCard(dragId,dragFrom,toCol);dragId=null;dragFrom=null;
}
function openForm(id){document.querySelectorAll('.add-form').forEach(f=>f.classList.remove('open'));const el=document.getElementById(id);if(el){el.classList.add('open');el.querySelector('textarea').focus();}}
function closeForm(id){const el=document.getElementById(id);if(el)el.classList.remove('open');}
function openModal(id){document.getElementById(id).classList.add('open');}
function closeModal(id){document.getElementById(id).classList.remove('open');}
document.querySelectorAll('.modal-overlay').forEach(el=>{el.addEventListener('click',e=>{if(e.target===el)el.classList.remove('open');});});
function switchView(name,btn){
  document.querySelectorAll('.view').forEach(v=>v.classList.remove('active'));
  document.querySelectorAll('.nav-tab').forEach(t=>t.classList.remove('active'));
  document.getElementById('view-'+name).classList.add('active');btn.classList.add('active');renderAllViews();
}
function toggleDone(){
  showDone=!showDone;document.getElementById('done-arrow').textContent=showDone?'‚ñº':'‚ñ∂';
  const el=document.getElementById('done-cards');if(el)el.style.display=showDone?'grid':'none';
}
let toastTimer;
function toast(msg){const el=document.getElementById('toast');el.textContent=msg;el.classList.add('show');clearTimeout(toastTimer);toastTimer=setTimeout(()=>el.classList.remove('show'),2500);}
document.addEventListener('keydown',e=>{if(e.key==='Escape'){document.querySelectorAll('.add-form').forEach(f=>f.classList.remove('open'));document.querySelectorAll('.modal-overlay').forEach(m=>m.classList.remove('open'));}});
init();
</script>
</body>
</html>
